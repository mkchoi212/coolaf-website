<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>üîà Swift Talk: Limiting the use of Protocols - 0xDEADBEEF</title>
    <meta name="description" content="TL;DR Practice like it‚Äôs real. So when it‚Äôs real, it‚Äôs just like practice">

    <link href='https://fonts.googleapis.com/css?family=Roboto+Mono|Roboto:300,400,900,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://www.deadbeef.me/2017/06/first-talk">
    <link rel="alternate" type="application/rss+xml" title="0xDEADBEEF" href="https://www.deadbeef.me/feed.xml">
    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>üîà Swift Talk: Limiting the use of Protocols | 0xDEADBEEF</title>
<meta name="generator" content="Jekyll v3.4.3" />
<meta property="og:title" content="üîà Swift Talk: Limiting the use of Protocols" />
<meta name="author" content="Mike JS. Choi" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="My first Swift talk" />
<meta property="og:description" content="My first Swift talk" />
<link rel="canonical" href="https://www.deadbeef.me/2017/06/first-talk" />
<meta property="og:url" content="https://www.deadbeef.me/2017/06/first-talk" />
<meta property="og:site_name" content="0xDEADBEEF" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-06-28T23:03:23-05:00" />
<script type="application/ld+json">
{"description":"My first Swift talk","author":{"@type":"Person","name":"Mike JS. Choi"},"@type":"BlogPosting","url":"https://www.deadbeef.me/2017/06/first-talk","headline":"üîà Swift Talk: Limiting the use of Protocols","dateModified":"2017-06-28T23:03:23-05:00","datePublished":"2017-06-28T23:03:23-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.deadbeef.me/2017/06/first-talk"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

    <body>
        <main class="u-container">
        <div class="c-page">
    <header class="c-page__header">
    <h1><code>0xDEADBEEF</code></h1>

    
    <p>
        <a href="/">Home</a><span
          class="u-separate"></span> <a href="/projects/">Projects</a><span class="u-separate"></span> <a href="/about/">About</a><span class="u-separate"></span><a href="/feed.xml">RSS</a>
    </p>
</header>

    <div class="c-page__main">
    <article class="c-article">
    <header class="c-article__header">
        <h1 class="c-article__title">üîà Swift Talk: Limiting the use of Protocols</h1>
        <p class="c-article__time"><time datetime="2017-06-28T23:03:23-05:00" itemprop="datePublished">Jun 28, 2017</time></p>
    </header>
    
    <!-- Post Tags -->
    <ul class="c-tags">
    
      <li class="c-tag">swift</li>
    
      <li class="c-tag">talk</li>
    
    </ul>

    <div class="c-article__main">
        <p><strong>TL;DR</strong> Practice like it‚Äôs real. So when it‚Äôs real, it‚Äôs just like practice</p>

<h1 id="product-first">Product first</h1>

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.10&appId=84797675741";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<center><div class="fb-post" data-href="https://www.facebook.com/realmkr/posts/1225888860872574" data-width="500" data-show-text="true"><blockquote cite="https://www.facebook.com/realmkr/posts/1225888860872574" class="fb-xfbml-parse-ignore"><p>Swift&#xb2c8;&#xae4c; &#xbb34;&#xc870;&#xac74; &#xd504;&#xb85c;&#xd1a0;&#xcf5c;&#xc744; &#xc368;&#xc57c; &#xd560;&#xae4c;&#xc694;? &#x1f914;
&#xd504;&#xb85c;&#xd1a0;&#xcf5c;&#xc744; &#xc81c;&#xb300;&#xb85c; &#xc0ac;&#xc6a9;&#xd558;&#xb294; &#xbc29;&#xbc95;&#xc744; &#xc54c;&#xb824;&#xb4dc;&#xb9bd;&#xb2c8;&#xb2e4;!</p><a href="https://www.facebook.com/realmkr/">Realm Korea</a>Ïóê ÏùòÌï¥ Í≤åÏãú Îê®&nbsp;<a href="https://www.facebook.com/realmkr/posts/1225888860872574">2017ÎÖÑ 7Ïõî 24Ïùº ÏõîÏöîÏùº</a></blockquote></div></center>

<p><img src="https://www.deadbeef.me/assets/let_us_go/talk_1.jpg" alt="" />
<img src="https://www.deadbeef.me/assets/let_us_go/talk_2.jpg" alt="" />
<img src="https://www.deadbeef.me/assets/let_us_go/talk_3.jpg" alt="" />
<img src="https://www.deadbeef.me/assets/let_us_go/talk_4.jpg" alt="" />
<em>Credits to these awesome photos go to</em> <a href="https://twitter.com/gbmKSquare">@gbmksquare</a></p>

<h1 id="the-talk">The Talk</h1>
<p>The topic of the talk was‚Ä¶</p>
<blockquote>
  <p>Using protocols everywhere in Swift is not a good thing.</p>
</blockquote>

<h2 id="protocols">Protocols?</h2>
<p>To see where I am trying to go with this, we first need to know what a protocol
is.
There are tons of tutorials online about protocols so I will keep it simple.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Object Oriented</th>
      <th style="text-align: center">‚úÖ Protocol Oriented</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><img src="http://machinethink.net/images/mixins-and-traits-in-swift-2/ShootingHelper.png" alt="" /></td>
      <td style="text-align: center"><img src="http://machinethink.net/images/mixins-and-traits-in-swift-2/GameTraits.png" alt="" /></td>
    </tr>
  </tbody>
</table>

<p>Basically, protocols allow you to go from the left to the right and that‚Äôs
considered a good thing.</p>

<p>Flatter architecture made possible with the concept of <strong>composition is easier to deal with than a complex class hiearchy</strong>.</p>

<h2 id="whats-so-bad-then">What‚Äôs so bad then?</h2>
<p>Let‚Äôs look at some examples.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">URLStringConvertible</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">urlString</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ...</span>

<span class="kd">func</span> <span class="nf">sendRequest</span><span class="p">(</span><span class="nv">urlString</span><span class="p">:</span> <span class="kt">URLStringConvertible</span><span class="p">,</span> <span class="nv">method</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="p">())</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="n">urlString</span><span class="o">.</span><span class="n">urlString</span>
<span class="p">}</span>
</code></pre>
</div>

<p>This <code class="highlighter-rouge">URLStringConvertible</code> is not accomplishing anything here and can simply be replaced by a value.</p>

<p>But somehow, I think a lot people feel as if using protocols for everything is the right thing to do in Swift.
Maybe this is because of the large number of <em>‚ÄúProtocol Oriented X‚Äù</em> tutorials on the web or maybe because Apple has been trying to sell Swift as a ‚ÄúProtocol Oriented Language‚Äù. But whatever the reason,</p>

<blockquote>
  <p>Using protocols without thinking about the consequences is <strong>NOT</strong> ideal</p>
</blockquote>

<h1 id="more-examples">More Examples</h1>
<p>Suppose we are making a library that is good at creating <code class="highlighter-rouge">UIView</code> elements with data inserted in them. 
I‚Äôm going to completely ignore what I just said above and make a protocol first because that‚Äôs the <em>‚Äúcool thing to do‚Äù</em>.</p>

<h2 id="protocol-oriented-approach">Protocol Oriented Approach</h2>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">HeaderViewProtocol</span> <span class="p">{</span>
    <span class="k">associatedtype</span> <span class="kt">Content</span>
    <span class="kd">func</span> <span class="nf">setHeader</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">Content</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>
<p>That looks like a cool protocol that will make us look like we know what we are doing. 
Let‚Äôs now apply this protocol to various UIView subclassess to build up our library.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">MyLabel</span><span class="p">:</span> <span class="kt">UILabel</span><span class="p">,</span> <span class="kt">HeaderViewProtocol</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">setHeader</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">data</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">MyButton</span><span class="p">:</span> <span class="kt">UIButton</span><span class="p">,</span> <span class="kt">HeaderViewProtocol</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">setHeader</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">titleLabel</span><span class="p">?</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">data</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Simple enough. I just successfully abstracted the idea of a class that can be used as a <code class="highlighter-rouge">HeaderView</code> with a single protocol.
Now, I want to make an array of <code class="highlighter-rouge">HeaderViewProtocol</code> elements so that I can later insert them into a <code class="highlighter-rouge">UICollectionView</code>.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">elements</span> <span class="o">=</span> <span class="p">[</span><span class="kt">MyLabel</span><span class="p">(),</span> <span class="kt">MyButton</span><span class="p">(),</span> <span class="kt">UIStackView</span><span class="p">()]</span>
</code></pre>
</div>

<p>Wait.. <code class="highlighter-rouge">UIStackView</code> isn‚Äôt a <code class="highlighter-rouge">HeaderViewProtocol</code> but why does the compiler not raise any errors?
If you look at <code class="highlighter-rouge">elements</code> type, the Swift compiler tells us that it‚Äôs just a <code class="highlighter-rouge">[UIView]</code> and not an array of <code class="highlighter-rouge">UIView</code>s that conform to <code class="highlighter-rouge">HeaderViewProtocol</code>.
You could go ahead and try things like</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">elements</span> <span class="p">:</span> <span class="p">[</span><span class="kt">HeaderViewProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kt">MyLabel</span><span class="p">(),</span> <span class="kt">MyButton</span><span class="p">(),</span> <span class="kt">UIStackView</span><span class="p">()]</span>
<span class="k">let</span> <span class="nv">elements</span> <span class="p">:</span> <span class="p">[</span><span class="kt">UIView</span><span class="o">&lt;</span><span class="kt">HeaderViewProtocol</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kt">MyLabel</span><span class="p">(),</span> <span class="kt">MyButton</span><span class="p">(),</span> <span class="kt">UIStackView</span><span class="p">()]</span>
</code></pre>
</div>

<p>but nothing works because there is not a way to express a class that conforms to a protocol type in Swift 3.
We could have done <code class="highlighter-rouge">UIView&lt;HeaderViewProtocol&gt;</code> in Objective-C but that‚Äôs a whole different story.</p>

<blockquote>
  <p><strong>Note</strong>: turns out you can do this in <strong>Swift 4</strong> with class subtype existentials but this doesn‚Äôt really change anything</p>
  <div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">elements</span><span class="p">:</span> <span class="p">[</span><span class="kt">HeaderViewProtocol</span> <span class="o">&amp;</span> <span class="kt">UIView</span><span class="p">]</span>
</code></pre>
  </div>
</blockquote>

<p>So in Swift 3, we need to go ahead and create a type eraser like this.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">AnyHeaderView</span><span class="o">&lt;</span><span class="kt">Content</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">HeaderViewProtocol</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">_setHeader</span><span class="p">:</span> <span class="p">(</span><span class="kt">Content</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span>
    
    <span class="kd">init</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">HeaderViewProtocol</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">view</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="k">where</span> <span class="kt">Content</span> <span class="o">==</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Content</span> <span class="p">{</span>
        <span class="n">_setHeader</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">setHeader</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">setHeader</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">Content</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nf">_setHeader</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Ok, that‚Äôs a lot of code to keep the compiler happy. Anyway, we can now go ahead make the array with type safety we want.</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">elements</span> <span class="o">=</span> <span class="p">[</span><span class="kt">AnyHeaderView</span><span class="p">(</span><span class="kt">MyLabel</span><span class="p">()),</span> <span class="kt">AnyHeaderView</span><span class="p">(</span><span class="kt">MyButton</span><span class="p">())]</span>
</code></pre>
</div>

<h2 id="value-oriented-approach">Value Oriented Approach</h2>
<blockquote>
  <p>But instead of <strong>passing in a type that promises things, couldn‚Äôt we just pass the things we promised?</strong></p>
</blockquote>

<p>Read that again and think about that for a second.</p>

<p>And to do just that, let‚Äôs make a type that can wrap all the things we promised into a struct.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">HeaderView</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="k">let</span> <span class="nv">view</span><span class="p">:</span> <span class="kt">UIView</span>
    <span class="k">let</span> <span class="nv">setHeader</span><span class="p">:</span> <span class="p">(</span><span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Now, we can do this‚Ä¶</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">label</span> <span class="o">=</span> <span class="kt">UILabel</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">labelHeader</span> <span class="o">=</span> <span class="kt">HeaderView</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">view</span><span class="p">:</span> <span class="n">label</span><span class="p">)</span> <span class="p">{</span> <span class="n">str</span> <span class="k">in</span>
    <span class="n">label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">str</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">imageView</span> <span class="o">=</span> <span class="kt">UIImageView</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">imageHeader</span> <span class="o">=</span> <span class="kt">HeaderView</span><span class="o">&lt;</span><span class="kt">UIImage</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">view</span><span class="p">:</span> <span class="n">imageView</span> <span class="p">)</span> <span class="p">{</span> <span class="n">img</span> <span class="k">in</span>
    <span class="n">imageView</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
<span class="p">}</span>
</code></pre>
</div>
<p>Using a struct instead of a protocol halved the code size. Once implemented, the solution seems almost too simple to be true that we wonder, ‚ÄúWhy couldn‚Äôt we think of this the first time?‚Äù
The reason maybe because we came up with a solution to a problem we didn‚Äôt even try tounderstand.</p>

<blockquote>
  <p>Pick the right tool for the job, not the other way around.</p>
</blockquote>

<h1 id="conclusion">Conclusion</h1>
<p>If using protocols in your code is making you write unncessary code to keep the compiler quiet and satisfied, maybe you should consider using struct / function values instead.</p>

<p>Here‚Äôs a general rule of thumb.</p>

<table>
  <thead>
    <tr>
      <th>Situation</th>
      <th>Solution</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1 function in protocol?</td>
      <td>Function</td>
    </tr>
    <tr>
      <td>1 &gt; functions?</td>
      <td>Protocol</td>
    </tr>
    <tr>
      <td>Used only once? (completion handlers, callbacks)</td>
      <td>Function</td>
    </tr>
    <tr>
      <td>Used a lot? (data source, delegate)</td>
      <td>Protocol</td>
    </tr>
  </tbody>
</table>

<h1 id="about-the-talk">About the talk</h1>

<p>This was my first ever programming talk. My content was very techinal and the talk had some live coding in the middle. So naturally, I was nervous.</p>

<p>The talk was held in Korea, at one of <a href="http://www.kakao.com/main">Kakao‚Äôs buildings</a>. I had just served 2 years in the Army and also had just come back from the <a href="http://isc-hpc.com">ISC</a> that was held in Germany for a week.</p>

<p>My flight landed the day before the conference so I was sleep deprived and so tired that I couldn‚Äôt really say all the things I had in my head. I was not prepared for this and maybe I was almost arrogant to think that I would be able to pull this off.</p>

<p>Oh well, at least I learned something from this. At least I won‚Äôt make the same mistake for my next talk! ü§¶‚Äç‚ôÇÔ∏è</p>


    </div>
  
    <!-- Previous / Next Buttons -->
    
    

    
    

    <div class="pagenav">
		
        <div class="wrapper" id="left">
          <small><b>Previous</b> Jun 13, 2017</small>
          <br>
            <a class="no-hov" href="/2017/06/globalizing-software-2">&laquo; Globalizing Software II</a>
        </div>
		
		
        <div class="wrapper" id="right">
          <small>Jul 16, 2017 <b>Next</b></small>
          <br>
          <a class="no-hov" href="/2017/07/transducers">Transducers in Swift &raquo;</a>
        </div>
		
		</div>

		<!-- Disqus comments view -->
		
		<div class="post-disqus">
				<section id="disqus_thread"></section>
				<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */

var disqus_config = function () {
  this.page.url = 'https://www.deadbeef.me/2017/06/first-talk';  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = '/2017/06/first-talk'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://deadbeef-me.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

		</div>
		
</article>

    </div>
    <footer class="c-page__footer">
    <p>&copy; Mike JS. Choi 2018</p>
    <p><a href="https://twitter.com/bananamlkshake2">Twitter</a><span class="u-separate"></span><a href="https://github.com/mkchoi212">Github</a></p>
</footer>

</div>

        </main>
    
    </body>
</html>
